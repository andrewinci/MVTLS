<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>Advanced Programming : TLS handshake: /Users/Darka/Dropbox/UNITN/AdvancedProgramming/Project/include/TLS.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Advanced Programming : TLS handshake
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">TLS.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &quot;<a class="el" href="_server_client_handshake_protocol_8h_source.html">ServerClientHandshakeProtocol.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_server_client_record_protocol_8h_source.html">ServerClientRecordProtocol.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_crypto_8h_source.html">Crypto.h</a>&quot;</code><br />
</div>
<p><a href="_t_l_s_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7c6bc0a015a0a78cb508614995b9172e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structhandshake__t.html">handshake_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_l_s_8h.html#a7c6bc0a015a0a78cb508614995b9172e">make_client_hello</a> (unsigned char *client_random, <a class="el" href="structcipher__suite__t.html">cipher_suite_t</a> <a class="el" href="_t_l_s_constants_8c.html#ace4b851fd953c51fe7b0ada522a95ae3">cipher_suite_list</a>[], int cipher_suite_len)</td></tr>
<tr class="separator:a7c6bc0a015a0a78cb508614995b9172e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3bb4e3f75fb84baa35cd0931381dfe0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structhandshake__t.html">handshake_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_l_s_8h.html#ab3bb4e3f75fb84baa35cd0931381dfe0">make_client_key_exchange</a> (<a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *<a class="el" href="server_8c.html#aa8eef32066e04e25183a0cc549992c54">TLS_param</a>, uint16_t key_ex_alg)</td></tr>
<tr class="separator:ab3bb4e3f75fb84baa35cd0931381dfe0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bed323f749e27db36fd6ab2a3e64c4a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structrecord__t.html">record_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_l_s_8h.html#a5bed323f749e27db36fd6ab2a3e64c4a">make_change_cipher_spec</a> ()</td></tr>
<tr class="separator:a5bed323f749e27db36fd6ab2a3e64c4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae149244e09cbbd2180bc4c5fc6d0a924"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structhandshake__t.html">handshake_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_l_s_8h.html#ae149244e09cbbd2180bc4c5fc6d0a924">make_finished_message</a> (<a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *<a class="el" href="server_8c.html#aa8eef32066e04e25183a0cc549992c54">TLS_param</a>)</td></tr>
<tr class="separator:ae149244e09cbbd2180bc4c5fc6d0a924"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a035a830fd89c6c7af60809197d81ea29"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structhandshake__t.html">handshake_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_l_s_8h.html#a035a830fd89c6c7af60809197d81ea29">make_server_hello</a> (<a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *<a class="el" href="server_8c.html#aa8eef32066e04e25183a0cc549992c54">TLS_param</a>, <a class="el" href="structserver__client__hello__t.html">server_client_hello_t</a> *client_hello)</td></tr>
<tr class="separator:a035a830fd89c6c7af60809197d81ea29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fd919275c5d6d3e6578c480cc62a8ce"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structhandshake__t.html">handshake_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_l_s_8h.html#a6fd919275c5d6d3e6578c480cc62a8ce">make_certificate</a> (<a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *<a class="el" href="server_8c.html#aa8eef32066e04e25183a0cc549992c54">TLS_param</a>)</td></tr>
<tr class="separator:a6fd919275c5d6d3e6578c480cc62a8ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a902d940508d7080023ef072b2667a143"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structhandshake__t.html">handshake_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_l_s_8h.html#a902d940508d7080023ef072b2667a143">make_server_key_exchange</a> (<a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *<a class="el" href="server_8c.html#aa8eef32066e04e25183a0cc549992c54">TLS_param</a>)</td></tr>
<tr class="separator:a902d940508d7080023ef072b2667a143"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af98aa49e2563d588c366ef1712de925a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structhandshake__t.html">handshake_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_l_s_8h.html#af98aa49e2563d588c366ef1712de925a">make_server_hello_done</a> ()</td></tr>
<tr class="separator:af98aa49e2563d588c366ef1712de925a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12a63a5becca8f85a59f6ac0f4d9c553"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_t_l_s_8h.html#a12a63a5becca8f85a59f6ac0f4d9c553">backup_handshake</a> (<a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *<a class="el" href="server_8c.html#aa8eef32066e04e25183a0cc549992c54">TLS_param</a>, <a class="el" href="structhandshake__t.html">handshake_t</a> *h)</td></tr>
<tr class="separator:a12a63a5becca8f85a59f6ac0f4d9c553"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>SSL/TLS Project</p>
<p>This file provide a set of function for the TLS handshake. The function are used for make TLS message for both server and client.</p>
<dl class="section date"><dt>Date</dt><dd>Created on 13/01/16. </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright © 2016 Alessandro Melloni, Andrea Francesco Vinci. All rights reserved. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a12a63a5becca8f85a59f6ac0f4d9c553"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void backup_handshake </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *&#160;</td>
          <td class="paramname"><em>TLS_param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structhandshake__t.html">handshake_t</a> *&#160;</td>
          <td class="paramname"><em>h</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Append the handshake h to the handshake_messages field of TLS_param</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TLS_param</td><td>: connection parameters </td></tr>
    <tr><td class="paramname">h</td><td>: the handshake to append </td></tr>
  </table>
  </dd>
</dl>

<p>Referenced by <a class="el" href="client_8c.html#aed2d0a7b3d9f68efed058f1bc0768e95">do_handshake()</a>, and <a class="el" href="client_8c.html#aa8faa003f922c3bb30adfd8952af808f">onPacketReceive()</a>.</p>

</div>
</div>
<a class="anchor" id="a6fd919275c5d6d3e6578c480cc62a8ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structhandshake__t.html">handshake_t</a>* make_certificate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *&#160;</td>
          <td class="paramname"><em>TLS_param</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Make the certificate message for the server. That message depends on the authentication algorithm hence we require the connection parameters. The function also sets the certificate in the connection parameters for feature uses.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TLS_param</td><td>: connection parameters </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the certificate handshake message </dd></dl>

<p>Referenced by <a class="el" href="server_8c.html#acf4f7155469cbb30edfa846d620b099b">onPacketReceive()</a>.</p>

</div>
</div>
<a class="anchor" id="a5bed323f749e27db36fd6ab2a3e64c4a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structrecord__t.html">record_t</a>* make_change_cipher_spec </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Make the change cipher spec record message. This message is simple and doesn't require any parameter.</p>
<dl class="section return"><dt>Returns</dt><dd>the change cipher spec record </dd></dl>

<p>Referenced by <a class="el" href="client_8c.html#aa8faa003f922c3bb30adfd8952af808f">onPacketReceive()</a>.</p>

</div>
</div>
<a class="anchor" id="a7c6bc0a015a0a78cb508614995b9172e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structhandshake__t.html">handshake_t</a>* make_client_hello </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>client_random</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structcipher__suite__t.html">cipher_suite_t</a>&#160;</td>
          <td class="paramname"><em>cipher_suite_list</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cipher_suite_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given an array of cipher suite make a client hello message. The function also fill the random field using the time stamp and a random generator(openssl)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client_random</td><td>: the random setted in the client hello </td></tr>
    <tr><td class="paramname">cipher_suite_list</td><td>: an array of cipher suite to add in the client hello </td></tr>
    <tr><td class="paramname">cipher_suite_len</td><td>: the number of cipher suite in the list </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the hello client handshake message </dd></dl>

<p>Referenced by <a class="el" href="client_8c.html#aed2d0a7b3d9f68efed058f1bc0768e95">do_handshake()</a>.</p>

</div>
</div>
<a class="anchor" id="ab3bb4e3f75fb84baa35cd0931381dfe0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structhandshake__t.html">handshake_t</a>* make_client_key_exchange </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *&#160;</td>
          <td class="paramname"><em>TLS_param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>key_ex_alg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given the information in the TLS_parameter and the key exchange algorithm return the handshake of the client key exchange. That include compute the pre-master key. It also compute the master secret and set in the TLS_param.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TLS_param</td><td>: the parameters of the connection </td></tr>
    <tr><td class="paramname">key_ex_alg</td><td>: the key exchange algorithm of the handshake </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the client key exchange handshake message </dd></dl>

<p>Referenced by <a class="el" href="client_8c.html#aa8faa003f922c3bb30adfd8952af808f">onPacketReceive()</a>.</p>

</div>
</div>
<a class="anchor" id="ae149244e09cbbd2180bc4c5fc6d0a924"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structhandshake__t.html">handshake_t</a>* make_finished_message </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *&#160;</td>
          <td class="paramname"><em>TLS_param</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given the connection parameters compute the finished message. Note in the TLS protocol this message is encrypted.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TLS_param</td><td>: the connection parameters </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the finished handshake message </dd></dl>

<p>Referenced by <a class="el" href="client_8c.html#aa8faa003f922c3bb30adfd8952af808f">onPacketReceive()</a>.</p>

</div>
</div>
<a class="anchor" id="a035a830fd89c6c7af60809197d81ea29"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structhandshake__t.html">handshake_t</a>* make_server_hello </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *&#160;</td>
          <td class="paramname"><em>TLS_param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structserver__client__hello__t.html">server_client_hello_t</a> *&#160;</td>
          <td class="paramname"><em>client_hello</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Given the client hello message the function makes the server hello. It choices a random cipher suite among the those provided by the client. The function also fill the random field using the time stamp and a random generator(openssl)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TLS_param</td><td>: the connection parameters </td></tr>
    <tr><td class="paramname">client_hello</td><td>: the received client hello. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the hello server handshake message </dd></dl>

<p>Referenced by <a class="el" href="server_8c.html#acf4f7155469cbb30edfa846d620b099b">onPacketReceive()</a>.</p>

</div>
</div>
<a class="anchor" id="af98aa49e2563d588c366ef1712de925a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structhandshake__t.html">handshake_t</a>* make_server_hello_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Make the server hello done message. This message is simple and doesn't require any parameter.</p>
<dl class="section return"><dt>Returns</dt><dd>the server hello done handshake message </dd></dl>

<p>Referenced by <a class="el" href="server_8c.html#acf4f7155469cbb30edfa846d620b099b">onPacketReceive()</a>.</p>

</div>
</div>
<a class="anchor" id="a902d940508d7080023ef072b2667a143"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structhandshake__t.html">handshake_t</a>* make_server_key_exchange </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_t_l_s__parameters__t.html">TLS_parameters_t</a> *&#160;</td>
          <td class="paramname"><em>TLS_param</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Make the server key exchange handshake message. The function also sets the message in the connection parameters for compute the master key in the client key exchange message.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">TLS_param</td><td>: connection parameters </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the server key exchange handshake message </dd></dl>

<p>Referenced by <a class="el" href="server_8c.html#acf4f7155469cbb30edfa846d620b099b">onPacketReceive()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
